<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JLPT Vocabulary Tracker</title>
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <header>
      <div
        style="
          display: flex;
          align-items: center;
          justify-content: space-between;
          gap: 12px;
          flex-wrap: wrap;
        "
      >
        <div>
          <h1 style="margin-bottom: 4px">JLPT Vocabulary Tracker</h1>
          <div style="color: rgba(255, 255, 255, 0.75); font-weight: 700">
            Library Mode ‚Ä¢
            <a
              id="openGameTop"
              href="hang.html"
              style="color: inherit; text-decoration: underline"
              >Game Mode</a
            >
            ‚Ä¢
            <a
              id="openMovieFlowTop"
              href="movie.html"
              style="color: inherit; text-decoration: underline"
              >MovieFlow</a
            >
          </div>
        </div>

        <div style="display: flex; gap: 10px; flex-wrap: wrap">
          <a
            id="openGameBtn"
            href="hang.html"
            style="
              display: inline-flex;
              align-items: center;
              gap: 8px;
              padding: 10px 12px;
              border-radius: 12px;
              border: 1px solid rgba(255, 255, 255, 0.18);
              background: rgba(0, 0, 0, 0.18);
              color: white;
              font-weight: 900;
              text-decoration: none;
            "
            title="Open Flowman / Hangman mode"
          >
            üéÆ Game Mode
          </a>

          <a
            id="openMovieFlowBtn"
            href="movie.html"
            style="
              display: inline-flex;
              align-items: center;
              gap: 8px;
              padding: 10px 12px;
              border-radius: 12px;
              border: 1px solid rgba(255, 255, 255, 0.18);
              background: linear-gradient(135deg, #3a3f51, #1f2230);
              color: white;
              font-weight: 900;
              text-decoration: none;
            "
            title="Open MovieFlow immersion mode"
          >
            üé¨ MovieFlow
          </a>
        </div>
      </div>

      <div class="controls">
        <!-- JLPT filter -->
        <label for="jlptFilter">JLPT Level:</label>
        <select id="jlptFilter">
          <option value="all">All</option>
          <option value="N1">N1</option>
          <option value="N2">N2</option>
          <option value="N3">N3</option>
          <option value="N4">N4</option>
          <option value="N5">N5</option>
        </select>

        <!-- Familiarity filter -->
        <label for="familiarityFilter">Familiarity:</label>
        <select id="familiarityFilter">
          <option value="all">All</option>
          <option value="well_known">Well Known</option>
          <option value="known">Known</option>
          <option value="explored">Explored</option>
          <option value="unknown">Unknown</option>
        </select>

        <!-- Favorites-only toggle -->
        <label for="favoritesOnly" style="display: flex; gap: 0.35rem">
          <input type="checkbox" id="favoritesOnly" />
          ‚≠ê Favorites only
        </label>

        <!-- Romaji toggle -->
        <label style="display: flex; gap: 0.35rem">
          <input type="checkbox" id="showRomaji" />
          Show Romaji
        </label>

        <!-- Data + stats controls -->
        <button id="resetProgress">üîÑ Reset Progress</button>
        <button id="exportData">‚¨áÔ∏è Export Data</button>
        <button id="importData">‚¨ÜÔ∏è Import Data</button>
        <input
          id="importFile"
          type="file"
          accept=".json"
          style="display: none"
        />
        <button id="toggleStats">üìä Show Stats</button>

        <!-- Today progress chip -->
        <span id="todayChip" class="chip"> Progress Points Today: 0 </span>

        <!-- MovieFlow exposure chip -->
        <span
          id="movieflowChip"
          class="chip"
          title="Total MovieFlow exposures today"
        >
          üé¨ MovieFlow Exposures Today: 0
        </span>
      </div>

      <button id="toggleKofi" style="margin-top: 10px">
        Hide Support Widget
      </button>

      <div class="kanji-controls">
        <label for="kanjiSize">Kanji Size:</label>
        <input type="range" id="kanjiSize" min="0.9" max="2.5" step="0.1" />
        <span id="kanjiSizeValue">1.3rem</span>

        <label style="display: flex; align-items: center; gap: 0.25rem">
          <input type="checkbox" id="kanjiBoldToggle" />
          Bold Kanji
        </label>
      </div>
    </header>

    <!-- Stats panel -->
    <section id="statsPanel" class="hidden">
      <div id="statsContainer"></div>
    </section>

    <!-- Main grid for word cards -->
    <main id="wordGrid">
      <!--
        Each card can now include:
        <div class="movieflow-exposure">
          üé¨ Seen <span class="movieflow-count">3</span>x
        </div>
      -->
    </main>

    <footer>
      <button id="prevPage">Prev</button>
      <span id="pageInfo"></span>
      <button id="nextPage">Next</button>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="script.js"></script>

    <!-- Ko-fi Floating Widget -->
    <script src="https://storage.ko-fi.com/cdn/scripts/overlay-widget.js"></script>
    <script>
      kofiWidgetOverlay.draw("danielgagepostma", {
        type: "floating-chat",
        "floating-chat.donateButton.text": "Support me",
        "floating-chat.donateButton.background-color": "#323842",
        "floating-chat.donateButton.text-color": "#fff",
      });

      function findKofiContainer() {
        const divs = document.querySelectorAll("div[id]");
        for (const el of divs) {
          const id = el.id.toLowerCase();
          if (id.includes("ko-fi") || id.includes("kofi")) {
            return el;
          }
        }
        return null;
      }

      function initKofiToggle() {
        const toggleBtn = document.getElementById("toggleKofi");
        if (!toggleBtn) return;

        let tries = 0;
        const maxTries = 40;

        const interval = setInterval(() => {
          const container = findKofiContainer();
          if (!container) {
            tries++;
            if (tries >= maxTries) clearInterval(interval);
            return;
          }

          clearInterval(interval);

          const hidden = localStorage.getItem("kofiHidden") === "true";
          if (hidden) {
            container.style.display = "none";
            toggleBtn.textContent = "Show Support Widget";
          } else {
            toggleBtn.textContent = "Hide Support Widget";
          }

          toggleBtn.addEventListener("click", () => {
            const isHidden = container.style.display === "none";
            container.style.display = isHidden ? "block" : "none";
            toggleBtn.textContent = isHidden
              ? "Hide Support Widget"
              : "Show Support Widget";
            localStorage.setItem("kofiHidden", String(!isHidden));
          });
        }, 300);
      }

      window.addEventListener("load", initKofiToggle);
    </script>
  </body>
</html>
